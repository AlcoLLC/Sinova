class SearchManager{constructor(){this.currentQuery="",this.currentPage=1,this.resultsPerPage=10,this.totalResults=0,this.searchResults=[],this.searchTimeout=null,this.messages={searchError:gettext("An error occurred during search. Please try again."),noResults:gettext("No results found for"),noResultsTip:gettext("You can try different keywords or use more general terms."),resultsFound:gettext("results found for"),showing:gettext("Showing"),of:gettext("of"),totalResults:gettext("total results")},this.initializeElements(),this.bindEvents(),this.loadFromURL()}initializeElements(){this.cancelBtn=document.querySelector(".page-header .cancel-button"),this.searchInput=document.querySelector(".search-input"),this.searchForm=document.querySelector(".search-form"),this.searchResultsInfo=document.querySelector(".search-results-info"),this.searchResultsCount=document.querySelector(".search-results-count"),this.searchResultsContainer=document.querySelector(".search-results-container"),this.paginationContainer=document.querySelector(".pagination-container"),this.paginationInfo=document.querySelector(".pagination-info"),this.pagination=document.querySelector(".pagination"),this.searchPlaceholder=document.querySelector(".search-placeholder"),this.searchLoading=document.querySelector(".search-loading")}bindEvents(){this.cancelBtn&&this.cancelBtn.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch()}),this.searchInput&&(this.searchInput.addEventListener("focus",e=>{setTimeout(()=>{this.searchInput.focus()},10)}),this.searchInput.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),0<this.searchInput.value.trim().length)&&this.performSearch(this.searchInput.value.trim()),"Escape"===e.key&&this.clearSearch()}),this.searchInput.addEventListener("input",e=>{this.searchTimeout&&clearTimeout(this.searchTimeout)})),this.searchForm&&this.searchForm.addEventListener("submit",e=>{e.preventDefault(),0<this.searchInput.value.trim().length&&this.performSearch(this.searchInput.value.trim())})}loadFromURL(){var e=new URLSearchParams(window.location.search),t=e.get("search"),e=parseInt(e.get("page"))||1;t?(this.searchInput.value=t,this.currentPage=e,this.performSearch(t,e)):(this.showPlaceholder(),setTimeout(()=>{this.searchInput&&this.searchInput.focus()},100))}clearSearch(){this.searchInput.value="",this.currentQuery="",this.currentPage=1,this.updateURL(),this.showPlaceholder(),setTimeout(()=>{this.searchInput&&this.searchInput.focus()},10)}showPlaceholder(){this.searchPlaceholder&&(this.searchPlaceholder.style.display="block"),this.searchResultsInfo&&(this.searchResultsInfo.style.display="none"),this.searchResultsContainer&&(this.searchResultsContainer.innerHTML=""),this.paginationContainer&&(this.paginationContainer.style.display="none"),this.searchLoading&&(this.searchLoading.style.display="none")}showLoading(){this.searchPlaceholder&&(this.searchPlaceholder.style.display="none"),this.searchResultsInfo&&(this.searchResultsInfo.style.display="none"),this.searchResultsContainer&&(this.searchResultsContainer.innerHTML=""),this.paginationContainer&&(this.paginationContainer.style.display="none"),this.searchLoading&&(this.searchLoading.style.display="block")}showError(e){this.searchLoading&&(this.searchLoading.style.display="none"),this.searchPlaceholder&&(this.searchPlaceholder.style.display="none"),this.searchResultsInfo&&(this.searchResultsInfo.style.display="none"),this.paginationContainer&&(this.paginationContainer.style.display="none"),this.searchResultsContainer&&(this.searchResultsContainer.innerHTML=`
        <div class="search-error">
          <p><i class="fa-solid fa-exclamation-triangle"></i> ${e}</p>
        </div>
      `)}async performSearch(e,t=1){this.showLoading(),this.currentQuery=e,this.currentPage=t;try{var s=await this.fetchSearchResults(e,t);if(!s.ok)throw new Error("Search request failed: "+s.status);var a=await s.json();this.searchResults=a.results||[],this.totalResults=a.total_results||0,this.currentPage=a.current_page||t,this.totalPages=a.total_pages||1,this.hasNext=a.has_next||!1,this.hasPrevious=a.has_previous||!1,this.displayResults(),this.updateURL()}catch(e){console.error("Search error:",e),this.showError(this.messages.searchError)}}async fetchSearchResults(e,t){e=new URLSearchParams({search:e,page:t,format:"json"}),t=this.getCSRFToken();return await fetch("/search/?"+e.toString(),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"}})}getCSRFToken(){var e=document.cookie.split("; ").find(e=>e.startsWith("csrftoken="));return e?e.split("=")[1]:(e=document.querySelector("[name=csrfmiddlewaretoken]"))?e.getAttribute("content"):(e=document.querySelector("[name=csrfmiddlewaretoken]"))?e.value:""}displayResults(){this.searchLoading&&(this.searchLoading.style.display="none"),0===this.searchResults.length?(this.searchResultsContainer&&(this.searchResultsContainer.innerHTML=`
          <div class="no-results">
            <p><i class="fa-solid fa-search"></i> ${this.messages.noResults} "${this.currentQuery}".</p>
            <p class="no-results-tip">${this.messages.noResultsTip}</p>
          </div>
        `),this.searchResultsInfo&&(this.searchResultsInfo.style.display="none"),this.paginationContainer&&(this.paginationContainer.style.display="none")):(this.searchResultsCount&&(this.searchResultsCount.textContent=`${this.totalResults} ${this.messages.resultsFound} "${this.currentQuery}"`),this.searchResultsInfo&&(this.searchResultsInfo.style.display="block"),this.searchResultsContainer&&(this.searchResultsContainer.innerHTML=this.searchResults.map(e=>this.createResultHTML(e)).join("")),1<this.totalPages?this.displayPagination():this.paginationContainer&&(this.paginationContainer.style.display="none"),this.highlightSearchTerms(this.currentQuery))}createResultHTML(e){return`
      <div class="search-result">
        <div class="result-content">
          ${e.image?`<div class="result-image"><img loading="lazy"  src="${e.image}" alt="${e.title}" /></div>`:""}
          <div class="result-text">
            <a href="${e.url}" class="result-type">${e.type} ></a>
            <h2><a href="${e.url}">${e.title}</a></h2>
            ${e.description?`<p class="result-description">${e.description}</p>`:""}
          </div>
        </div>
        <button class="result-btn">
          <a href="${e.url}"><i class="fa-solid fa-arrow-right"></i></a>
        </button>
      </div>
    `}displayPagination(){var e=(this.currentPage-1)*this.resultsPerPage+1,t=Math.min(this.currentPage*this.resultsPerPage,this.totalResults);this.paginationInfo&&(this.paginationInfo.textContent=`${this.messages.showing} ${e}â€“${t} ${this.messages.of} ${this.totalResults} `+this.messages.totalResults);let s="";this.hasPrevious&&(s+=`<a href="#" class="page-btn" data-page="${this.currentPage-1}"><i class="fa-solid fa-chevron-left"></i></a>`);let a=Math.max(1,this.currentPage-Math.floor(2.5));var r=Math.min(this.totalPages,a+5-1);1<(a=r-a+1<5?Math.max(1,r-5+1):a)&&(s+='<a href="#" class="page-btn" data-page="1">1</a>',2<a)&&(s+='<span class="ellipsis">...</span>');for(let e=a;e<=r;e++)e===this.currentPage?s+=`<span class="page-btn active">${e}</span>`:s+=`<a href="#" class="page-btn" data-page="${e}">${e}</a>`;r<this.totalPages&&(r<this.totalPages-1&&(s+='<span class="ellipsis">...</span>'),s+=`<a href="#" class="page-btn" data-page="${this.totalPages}">${this.totalPages}</a>`),this.hasNext&&(s+=`<a href="#" class="page-btn" data-page="${this.currentPage+1}"><i class="fa-solid fa-chevron-right"></i></a>`),this.pagination&&(this.pagination.innerHTML=s),this.paginationContainer&&(this.paginationContainer.style.display="block"),this.pagination&&this.pagination.querySelectorAll(".page-btn[data-page]").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=parseInt(t.getAttribute("data-page"));this.goToPage(e)})})}goToPage(e){this.currentPage=e,this.performSearch(this.currentQuery,e),window.scrollTo({top:document.querySelector(".search-results-container")?.offsetTop-100||0,behavior:"smooth"})}updateURL(){var e=new URL(window.location);this.currentQuery?(e.searchParams.set("search",this.currentQuery),1<this.currentPage?e.searchParams.set("page",this.currentPage):e.searchParams.delete("page")):(e.searchParams.delete("search"),e.searchParams.delete("page")),window.history.replaceState({},"",e.toString())}highlightSearchTerms(e){if(e){var s=document.querySelectorAll(".result-text h2 a, .result-text .result-description"),e=(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e.split(/\s+/).filter(e=>0<e.length).map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"));let t=new RegExp(`(${e})`,"gi");s.forEach(e=>{e.innerHTML&&!e.querySelector(".highlight")&&(e.innerHTML=e.innerHTML.replace(t,'<span class="highlight">$1</span>'))})}}}class NavbarManager{constructor(){this.bindScrollEvents()}bindScrollEvents(){let e=!1;window.addEventListener("scroll",()=>{e||(requestAnimationFrame(()=>{this.handleNavbarScroll(),this.handleWhatsappButtons(),e=!1}),e=!0)})}handleNavbarScroll(){var e=document.querySelector(".navbar"),t=document.querySelector("nav");e&&t&&(20<window.scrollY?(e.classList.remove("transparent"),e.classList.add("scrolled"),t.classList.add("scrolled-nav")):(e.classList.add("transparent"),e.classList.remove("scrolled"),t.classList.remove("scrolled-nav")))}handleWhatsappButtons(){var e=document.querySelector(".header-whatsapp"),t=document.querySelector(".fixed-whatsapp");t&&(100<window.scrollY?(t.style.opacity="1",t.style.visibility="visible",e&&(e.style.opacity="0",e.style.visibility="hidden")):(t.style.opacity="0",t.style.visibility="hidden",e&&(e.style.opacity="1",e.style.visibility="visible")))}}function initializeSimpleSearch(){var r=document.querySelector(".page-header .cancel-button");let t=document.querySelector(".search-input"),s=document.querySelector(".search-form");gettext("No results found for"),gettext("You can try different keywords or use more general terms.");r&&r.addEventListener("click",function(e){e.preventDefault(),t.value="",t.focus();e=new URL(window.location);e.searchParams.delete("search"),e.searchParams.delete("page"),window.location.href=e.toString()}),t&&(t.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),0<t.value.trim().length)&&s.submit(),"Escape"===e.key&&(t.value="",(e=new URL(window.location)).searchParams.delete("search"),e.searchParams.delete("page"),window.location.href=e.toString())}),t.value||t.focus()),document.querySelectorAll(".page-btn[data-page]").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t,e=this.getAttribute("data-page");e=e,(t=new URL(window.location)).searchParams.set("page",e),window.location.href=t.toString()})});r=document.querySelector("[data-search-query]"),r=r?r.getAttribute("data-search-query"):"";if(r&&r.trim()){r=r.trim();let e=document.querySelectorAll(".result-text h2, .result-text .result-description"),t=r.split(/\s+/).filter(e=>0<e.length),s=t.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),a=new RegExp(`(${s})`,"gi");e.forEach(function(e){e.innerHTML&&!e.querySelector(".highlight")&&(e.innerHTML=e.innerHTML.replace(a,'<span class="highlight">$1</span>'))})}}document.addEventListener("DOMContentLoaded",function(){0<document.querySelector(".search-results-container")?.children.length?initializeSimpleSearch():new SearchManager,new NavbarManager});